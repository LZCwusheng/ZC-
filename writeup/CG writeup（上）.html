<html>
<head>
  <title>CG writeup（上）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1859"/>
<h1>CG writeup（上）</h1>

<div>
<span><div><font style="font-size: 16pt;"><b>签到题</b></font></div><div><font style="font-size: 12pt;">f12找到flag</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>md5 collision</b></font></div><div><font style="font-size: 12pt;">md5碰撞，payload进行md5加密后得到以&quot;0e&quot;开头的字符串，值为false</font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image.png" type="image/png" data-filename="Image.png"/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>签到2</b></font></div><div><font style="font-size: 12pt;">f12修改修改输入框的长度限制，再输入口令：</font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [1].png" type="image/png" data-filename="Image.png"/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>单身二十年</b></font></div><div><font style="font-size: 12pt;">原来是跳转到./search_key.php，但重定向到其它页面，burpsuite抓包即可。</font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [2].png" type="image/png" data-filename="Image.png" width="411"/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>这题不是WEB</b></font></div><div><font style="font-size: 12pt;">下载动态图，notepad打开图片，搜索ctf，找到flag</font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [3].png" type="image/png" data-filename="Image.png" width="309"/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>层层递进</b></font></div><div><font style="font-size: 12pt;">右键打开查看源代码，点击iframe的SO.html，再点击S0.html，再点击SO.htm，再点击S0.htm，flag：</font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [4].png" type="image/png" data-filename="Image.png" width="634"/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>AAencode</b></font></div><div><font style="font-size: 12pt;">颜文字js加密，先设置浏览器的编码为unicode，才能显示颜文字密文，把密文扔到控制台解密。</font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [5].png" type="image/png" data-filename="Image.png" width="885"/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>单身一百年也没用</b></font></div><div><font style="font-size: 12pt;">重定向，与之前那一道不同，那道是js脚本跳转，这是服务器设置location跳转（302），所以没有中间页面的存在。burpsuite抓包，reapter发包即可。</font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [6].png" type="image/png" data-filename="Image.png" width="357"/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>php decode</b></font></div><div><font style="font-size: 12pt;">加密webshell，去掉eval函数，添加echo，运行脚本得到flag：</font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [7].png" type="image/png" data-filename="Image.png" width="588"/></font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [8].png" type="image/png" data-filename="Image.png" width="361"/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>文件包含</b></font></div><div><font style="font-size: 12pt;">include支持流封装协议，所以用payload：file=php://filter/read=convert.base64-encode/resource=./index.php可以读取文件内容，而不是执行脚本。</font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [9].png" type="image/png" data-filename="Image.png" width="1105"/></font></div><div><font style="font-size: 12pt;">base64解密得到flag</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>COOKIE</b></font></div><div><font style="font-size: 12pt;">tip:0==not，意思是1==yes，修改cookie中login值为1即可。</font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [10].png" type="image/png" data-filename="Image.png" width="741"/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>MySQL</b></font></div><div><font style="font-size: 12pt;">查看robots.txt，含有提示信息和sql.php源代码，payload:  sql.php?id=1024.1，intval('1024.1')=1024，但1024.1 != 1024，所以成功绕过</font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [11].png" type="image/png" data-filename="Image.png"/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>GBK Injection</b></font></div><div><font style="font-size: 12pt;">宽字节注入，?id=1' 的单引号被转义，添加%df，它将与&quot;\&quot;合并成一个字符，造成单引号逃逸，单引号起到闭合作用，就可以继续注入语句：</font></div><div><font style="font-size: 12pt;">（1）?id=%df%27 union select 1,database() --+    爆库</font></div><div><font style="font-size: 12pt;">（2）?id=%df%27 union select 1,table_name from information_schema.tables where table_schema=database() limit 0,1 --+   爆表，增加limit x,1的x值，爆出所有表</font></div><div><font style="font-size: 12pt;">（3）?id=%df%27 union select 1,column_name from information_schema.columns where table_name=0x63746634 limit 0,1 --+   爆列名，注意单引号已经被转义，用16进制表示字符串</font></div><div><font style="font-size: 12pt;">（4）?id=%df%27 union select 1,flag from ctf4 limit 0,1 --+         找到flag</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>/x00</b></font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [12].png" type="image/png" data-filename="Image.png" width="438"/></font></div><div><font style="font-size: 12pt;"><b>方法1</b></font></div><div><font style="font-size: 12pt;">传入数组，payload为nctf[]=1，那么ereg()函数返回NULL，&quot;===&quot;比较的结果为false，接着strpos()函数返回NULL，&quot;!==&quot;比较的结果为true，得到flag</font></div><div><font style="font-size: 12pt;"><b>方法2</b></font></div><div><font style="font-size: 12pt;">%00截断，payload为123%00%23biubiubiu（&quot;#&quot;编码为%23，不然#往后的部分为键值对的一部分），%00可以截断ereg()，因此匹配的目标字符串实际上是&quot;123&quot;，返回结果true。%00不截断strpos()函数，因此匹配的字符串是&quot;123#biubiubiu&quot;，含有字符串&quot;#biubiubiu&quot;，返回结果为true，获得flag。</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>bypass again</b></font></div><div><font style="font-size: 12pt;">弱类型比较，$_GET['a']和$_GET['b']进行md5加密后都是以&quot;0e&quot;开头的字符串，&quot;==&quot;比较时，科学计数法得到其值都为&quot;0&quot;的次幂，即0</font></div><div><font style="font-size: 12pt;">payload: </font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [13].png" type="image/png" data-filename="Image.png"/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>变量覆盖</b></font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [14].png" type="image/png" data-filename="Image.png" width="601"/></font></div><div><font style="font-size: 12pt;">extract($array)函数的作用是将每一个键名作为变量名，其键值作为变量值，有多少个键值对，就有多少个变量，返回结果为变量的个数。</font></div><div><font style="font-size: 12pt;">将文本框的&quot;name&quot;属性值改为&quot;thepassword_123&quot;，value为NULL，如此post发送的键值对就是thepassword_123=&quot;&quot;。提交到PHP处理后，$thepassword_123的值就被重置为NULL，$pass没有赋值，所以也为NULL，这样就成功绕过条件判断，获得flag。</font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [15].png" type="image/png" data-filename="Image.png" width="380"/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>SQL注入1</b></font></div><div><font style="font-size: 12pt;">查看源码，构造payload：admin') or ('1'='1 ，密码随便输入</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>pass check</b></font></div><div><font style="font-size: 12pt;">post提交：pass[]=1，$_POST['pass']接收的参数就是一个数组，strcmp($pass, $pass1)的参数$pass是一个数组，strcmp函数直接返回false，成功绕过。</font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [16].png" type="image/png" data-filename="Image.png" width="877"/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>伪装者</b></font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [17].png" type="image/png" data-filename="Image.png" width="491"/></font></div><div><font style="font-size: 12pt;">程序根据IP地址确认是否在本地登录，本地登录的IP地址是127.0.0.1，添加X-Forwarded-For头，但发送后没有成功，查阅资料后，发现还有一个Client-IP。</font></div><div><span style="font-weight: bold; text-decoration: underline;"><font style="font-size: 12pt;">Client-ip首部是一些比较老的客户端和代理使用的扩展首部,用来传输运行客户端程序的计算机P地址。</font></span></div><div><font style="font-size: 12pt;">添加client-ip头后，成功获得flag。</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>文件上传</b></font></div><div><font style="font-size: 12pt;">主页</font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [18].png" type="image/png" data-filename="Image.png" width="428"/></font></div><div><font style="font-size: 12pt;">上传一个jpg，发现后缀名必须是.php</font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [19].png" type="image/png" data-filename="Image.png" width="985"/></font></div><div><font style="font-size: 12pt;">上传一个php，发现又必须是jpg等图片后缀名</font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [20].png" type="image/png" data-filename="Image.png" width="714"/></font></div><div><font style="font-size: 12pt;">上传1.php并修改报文即可绕过。</font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [21].png" type="image/png" data-filename="Image.png"/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>起名字真难</b></font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [22].png" type="image/png" data-filename="Image.png" width="481"/></font></div><div><font style="font-size: 12pt;">payload：?key=0xccccccccc，不包含数字0-9，绕过判断条件，接着在与数字弱类型比较时，十六进制转换成十进制，两者相等，结果返回true，获得flag。</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>密码重置</b></font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [23].png" type="image/png" data-filename="Image.png" width="714"/></font></div><div><font style="font-size: 12pt;">（1）先修改url的user1参数值为admin的base64编码值，回车访问一次页面；</font></div><div><font style="font-size: 12pt;">（2）再f12删除文本框的readonly，方可修改账号为admin；</font></div><div><font style="font-size: 12pt;">（3）输入密码和验证码，重置密码，成功获得flag。</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 16pt;"><b>SQL Injection</b></font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [24].png" type="image/png" data-filename="Image.png" width="651"/></font></div><div><font style="font-size: 12pt;">输入的username字符串和password字符串不会被去掉&quot;\&quot;，因为get_magic_quotes 始终返回 <span style="font-weight: bold;">FALSE</span>（这个魔术引号功能已经从 PHP 中移除了），所以不会执行stripslashes()函数。</font></div><div><font style="font-size: 12pt;">单引号和双引号被转换成实体，即&quot;&amp;lt;&quot;和&quot;&amp;gt;&quot;，因此没有不会起到闭合作用。但是，我们可以输入反斜杠转义掉$username后面的单引号，字符串延长到$password前面的单引号。接着，$password输入：or 1=1 --+，把最后面的单引号注释掉，</font></div><div><font style="font-size: 12pt;">并且整个条件语句必为真，最终能够返回查询集，获得flag。</font></div><div><font style="font-size: 12pt;">payload：</font></div><div><font style="font-size: 12pt;"><img src="CG writeup（上）_files/Image [25].png" type="image/png" data-filename="Image.png"/></font></div><div><font style="font-size: 12pt;">注意：admin非必需。</font></div><div><span style="font-size: 12pt;"><br/></span></div><div><br/></div></span>
</div></body></html> 