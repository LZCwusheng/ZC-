<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2115"/>

<div>
<span><div><font style="font-size: 12pt;">CG的web题目可以做的都做完了，在此对这次刷题进行总结，整理一下知识点，这里只列出一些对我来说比较新颖的知识点。需要注意的是，这个题库所有题目的PHP版本不是最新的，至少不是PHP7+。因此，部分知识在PHP7+不一定适用。</font></div><div><font style="font-size: 18pt;"><b><br/></b></font></div><div><font style="font-size: 18pt;"><b>md5碰撞</b></font></div><div><font style="font-size: 12pt;">md5碰撞的原理是：以&quot;0e&quot;开头且后面全是数字的字符串，在弱类型比较中被解释成科学计数法的0^n次幂，即 0。</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">if(&quot;0e213123&quot; == &quot;0&quot;){</font></div><div><font style="font-size: 12pt;">        var_dump(true);</font></div><div><font style="font-size: 12pt;">}</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">结果：bool(true)</font></div></div><div><font style="font-size: 12pt;">利用这一点，可以使两个不同的明文而md5加密后都是以&quot;0e&quot;开头且后面全是数字的字符串，在弱类型比较中相等，从而绕过验证。</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">if(md5('s155964671a') == md5('s214587387a')){</font></div><div><font style="font-size: 12pt;">        var_dump(true);</font></div><div><font style="font-size: 12pt;">}</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">结果：bool(true)</font></div></div><div><font style="font-size: 18pt;"><b><br/></b></font></div><div><font style="font-size: 18pt;"><b>重定向</b></font></div><div><font style="font-size: 12pt;">重定向的状态为302，重定向的方式有两种，一是服务器端PHP设置location头，二是JavaScript代码跳转。</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">&lt;?php</font></div><div><font style="font-size: 12pt;">header('Location: http://www.baidu.com/');</font></div><div><font style="font-size: 12pt;">exit;</font></div><div><font style="font-size: 12pt;">?&gt;</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">&lt;?php</font></div><div><font style="font-size: 12pt;">    echo &quot;&lt;script&gt;window.location='http://www.baidu.com'&lt;/script&gt;&quot;;</font></div><div><font style="font-size: 12pt;">?&gt;</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">结果：都会跳转，两种方式区别在于第一种直接重新发送get请求，而第二种有一个中间页面执行js代码，再发送get请求</font></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 18pt;"><b>aaencode</b></font></div><div><font style="font-size: 12pt;">因为JavaScript1.5之后标识符不仅可以由ASCII组成，也可以是Unicode字符，再混淆一些代码，就看起来像乱码一样。这就是JavaScript颜文字加密的原理。实际上它仍是代码，所以可以在控制台直接执行。详细解释可看<a href="https://stackoverflow.com/questions/22588223/how-does-this-magic-javascript-code-work">这里</a>。</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 18pt;"><b>压缩加密webshell</b></font></div><div><font style="font-size: 12pt;">gzdeflate()和gzinflate()是压缩和解压函数，base64_encode()和base64_decode()是base64加密和解密函数，利用这两对函数可以实现加密webshell。</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">function jiami($str){</font></div><div><font style="font-size: 12pt;">    $str2 = '';</font></div><div><font style="font-size: 12pt;">    for($i = 0; $i&lt;strlen($str) ; $i++){      // 字符串ASCII + 1</font></div><div><font style="font-size: 12pt;">        $str2.=chr(ord($str[$i])+1);</font></div><div><font style="font-size: 12pt;">    }</font></div><div><font style="font-size: 12pt;">    return base64_encode(gzdeflate($str2));   // 压缩和加密字符串</font></div><div><font style="font-size: 12pt;">}</font></div><div><font style="font-size: 12pt;">echo jiami(&quot;phpinfo();&quot;);</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><span style="color: rgb(51, 51, 51); font-family: Monaco;">结果：</span>K8wszMpPL9DUsgEA</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">function CLsI($ZzvSWE) {</font></div><div><font style="font-size: 12pt;">    $ZzvSWE = gzinflate(base64_decode($ZzvSWE));  // 对密文解密和解压</font></div><div><font style="font-size: 12pt;">    for ($i = 0; $i &lt; strlen($ZzvSWE); $i++) {</font></div><div><font style="font-size: 12pt;">        $ZzvSWE[$i] = chr(ord($ZzvSWE[$i]) - 1);  // 字符串ASCII - 1</font></div><div><font style="font-size: 12pt;">    }</font></div><div><font style="font-size: 12pt;">    return $ZzvSWE;</font></div><div><font style="font-size: 12pt;">}</font></div><div><font style="font-size: 12pt;">echo CLsI(&quot;K8wszMpPL9DUsgEA&quot;);</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">结果：phpinfo();</font></div></div><div><font style="font-size: 12pt;">如果把echo换成eval()函数，就可以直接执行代码了。</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 18pt;"><b>robots协议</b></font></div><div><font style="font-size: 12pt;">robots协议也叫robots.txt（统一小写）是一种存放于网站根目录下的ASCII编码的文本文件，它通常告诉网络搜索引擎的漫游器（又称网络蜘蛛），此网站中的哪些内容是不应被搜索引擎的漫游器获取的，哪些是可以被漫游器获取的。详细请看<a href="https://baike.baidu.com/item/robots%E5%8D%8F%E8%AE%AE/2483797?fromtitle=robots.txt&amp;fromid=9518761&amp;fr=aladdin">这里</a>。</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 18pt;"><b>/x00截断字符串</b></font></div><div><font style="font-size: 12pt;">/x00是空白字符，它是字符串的结尾标志。在正则匹配函数中，对字符串的匹配只到第一个/x00，往后的字符串不再匹配。</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">// str=1231%00asdasd</font></div><div><font style="font-size: 12pt;">if(ereg(&quot;^[1-9]+$&quot; , $_GET['str']) == true){</font></div><div><font style="font-size: 12pt;">        var_dump(true);</font></div><div><font style="font-size: 12pt;">}</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">结果：bool(true)            // 1231为纯数字字符串，ereg匹配成功，返回 1</font></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12pt;">往后的asdasd不再匹配</font></span></div></div><div><font style="font-size: 12pt;">但是在字符串函数中，字符串会被全部检索。</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">if(strpos(&quot;^[1-9]+$&quot; , $_GET['str']) == true){</font></div><div><font style="font-size: 12pt;">        var_dump(true);</font></div><div><font style="font-size: 12pt;">}else{</font></div><div><font style="font-size: 12pt;">        var_dump(false);</font></div><div><font style="font-size: 12pt;">}</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">结果：bool(false)        // 检索全部字符串</font></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 18pt;"><b>变量覆盖</b></font></div><div><font style="font-size: 12pt;">如果我们可以控制变量名，那么就可以使它等于已定义的一些变量，从而覆盖变量原来的值。</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">// ?str=1234</font></div><div><font style="font-size: 12pt;">$str = &quot;abcd&quot;;            // $str原来的值</font></div><div><font style="font-size: 12pt;">extract($_GET);           // 数组键名作为变量名，键值作为变量值</font></div><div><font style="font-size: 12pt;">echo $str;</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12pt;">结果：1234                               // 覆盖值</font></span></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 18pt;"><b>参数为数组</b></font></span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12pt;">如果函数的参数不应该是数组，那么传入参数的值为数组，函数返回值就为NULL。</font></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">$arr=array(1,2);</font></div><div><font style="font-size: 12pt;">var_dump(strstr($arr,&quot;1234&quot;));</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12pt;">结果：NULL</font></span></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 18pt;"><b>0、false和NULL</b></font></div><div><font style="font-size: 12pt;">在弱类型比较中，0、false和NULL是相等的。</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">var_dump(0==false &amp;&amp; 0==NULL &amp;&amp; false==NULL);</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">结果：bool(true)</font></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 18pt;"><b>client-ip</b></font></div><div><font style="font-size: 12pt;">Client-ip首部是一些比较老的客户端和代理使用的扩展首部,用来传输运行客户端程序的计算机IP地址。</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 18pt;"><b>十六进制和十进制的弱类型比较</b></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">var_dump('0x10' == 16);</font></div><div><font style="font-size: 12pt;">var_dump('0x10' == '16');</font></div><div><font style="font-size: 12pt;">var_dump(0x10 == '16');</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">结果：</font></div><div><font style="font-size: 12pt;">bool(true) </font></div><div><font style="font-size: 12pt;">bool(true) </font></div><div><font style="font-size: 12pt;">bool(true)</font></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 18pt;"><b>数据库特性</b></font></div><div><font style="font-size: 12pt;">在数据库中，字符串包含的'\'也有转义的作用。</font></div><div><font style="font-size: 12pt;"><img src="CG总结_files/Image.png" type="image/png" data-filename="Image.png"/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 18pt;"><b>.bash_history</b></font></div><div><font style="font-size: 12pt;">每个用户的根目录下都有一个.bash_history文件,他是隐藏文件,需要使用-a参数才会显示出来。这个文件的作用是保存了当前用户使用过的历史命令,方便以后查找。</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">vim备份文件</font></div><div><font style="font-size: 12pt;">当非正常关闭vim编辑器时（比如直接关闭终端或者电脑断电），会生成一个.swp文件，这个文件是一个临时交换文件，用来备份缓冲区中的内容。备份文件名：文件名.swp，文件名包含后缀。</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 18pt;"><b>data://流封装协议</b></font></div><div><font style="font-size: 12pt;">这个数据流与文件系统函数搭配，可以直接读取数据，不需要原有文件。</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">echo file_get_contents('data://text/plain,thisis');</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">结果：thisis</font></div></div><div><font style="font-size: 12pt;">还可以在读取的过程中base64解密.</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">echo file_get_contents('data://text/plain;base64,dGhpc2lz');</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">结果：thisis</font></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 18pt;"><b>preg_match()的第三个参数</b></font></div><div><font style="font-size: 12pt;">preg_match()第三个参数是匹配到的模式，包括子模式，但首元素是完全模式。</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">$content='[a]url[/a]';</font></div><div><font style="font-size: 12pt;">preg_match(&quot;/(.*)\[a\](.*)\[\/a\](.*)/&quot;,$content,$url);</font></div><div><font style="font-size: 12pt;">var_dump($url);</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 12pt;">结果：</font></span></div><div><font style="font-size: 12pt;">array(4) {</font></div><div><font style="font-size: 12pt;">  [0]=&gt;</font></div><div><font style="font-size: 12pt;">  string(10) &quot;[a]url[/a]&quot;</font></div><div><font style="font-size: 12pt;">  [1]=&gt;</font></div><div><font style="font-size: 12pt;">  string(0) &quot;&quot;</font></div><div><font style="font-size: 12pt;">  [2]=&gt;</font></div><div><font style="font-size: 12pt;">  string(3) &quot;url&quot;</font></div><div><font style="font-size: 12pt;">  [3]=&gt;</font></div><div><font style="font-size: 12pt;">  string(0) &quot;&quot;</font></div><div><font style="font-size: 12pt;">}</font></div></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 18pt;"><b>preg_replace()可以执行命令</b></font></div><div><font style="font-size: 12pt;">preg_replace()在旧版本PHP是可以在正则匹配模式/e的情况下，如果匹配成功，就可以直接将第二个参数作为代码执行。本地测试一下：</font></div><div><font style="font-size: 12pt;"><img src="CG总结_files/Image [1].png" type="image/png" data-filename="Image.png"/></font></div><div><font style="font-size: 12pt;"><img src="CG总结_files/Image [2].png" type="image/png" data-filename="Image.png" width="755"/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 18pt;"><b>scandir读取目录</b></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">var_dump(scandir('./'));</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">结果：</font></div><div><font style="font-size: 12pt;">array(14) {</font></div><div><font style="font-size: 12pt;">  [0]=&gt;</font></div><div><font style="font-size: 12pt;">  string(1) &quot;.&quot;</font></div><div><font style="font-size: 12pt;">  [1]=&gt;</font></div><div><font style="font-size: 12pt;">  string(2) &quot;..&quot;</font></div><div><font style="font-size: 12pt;">  [2]=&gt;</font></div><div><font style="font-size: 12pt;">  string(7) &quot;.vscode&quot;</font></div><div><font style="font-size: 12pt;">  [3]=&gt;</font></div><div><font style="font-size: 12pt;">  string(12) &quot;cardinal.php&quot;</font></div><div><font style="font-size: 12pt;">  [4]=&gt;</font></div><div><font style="font-size: 12pt;">  string(10) &quot;cookie.txt&quot;</font></div><div><font style="font-size: 12pt;">}</font></div></div></span>
</div></body></html> 